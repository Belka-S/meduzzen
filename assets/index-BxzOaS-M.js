import{a as A,b as C,n as F,r as p,i as T,v as q,j as o,B as L,w as z,q as M,x as H,y as G,V as J,l as O,z as K,A as U,C as B,I as Q,o as W,D as X,E as V,F as Y,G as Z,O as tt,c as st,P as at,H as D}from"./index-0c623FNQ.js";import{g as et,I as nt,a as ot,P as rt}from"./getArrFromObj-BeGakrOr.js";import{S as it}from"./index-C6sbcqFx.js";import{C as ct}from"./index-DDHBhZ4A.js";import{t as I}from"./trimName-Cn-Df3iO.js";const lt="_form_5nafv_1",mt="_button_5nafv_5",R={form:lt,button:mt},dt=()=>{const k=A(),_=C(),{user:a}=F(),[e,r]=p.useState(""),{register:t,control:v,handleSubmit:m,formState:b}=T({mode:"onChange"}),N=async l=>{const s=new FormData;let n=l.file[0];n!=null&&n.type||(n=l.file),s.append("file",n),await _(z(s)),k(M(!1)),document.location.reload()},h=async l=>{const n=l.target.files[0],c=URL.createObjectURL(n);k(H({user_avatar:c}));try{await G.validate({file:n},{abortEarly:!1}),r("noError")}catch(f){if(f instanceof J){const u=f.inner[0].message;O.error(u),r(u)}return f}},d=`profile-${et(12)}`,g=K(60);p.useEffect(()=>{if(a!=null&&a.user_avatar)document.styleSheets[0].insertRule(`#${d} {background-image: url(${a==null?void 0:a.user_avatar})}`,0);else if(a!=null&&a.user_firstname||a!=null&&a.user_lastname){const l=q(`${a==null?void 0:a.user_firstname} ${a==null?void 0:a.user_lastname}`);document.styleSheets[0].insertRule(`#${d}::after { background-color: ${g}; color: #ffffff; content: '${l}'}`)}},[d,g,a]);const y=e==="noError"?"":e,x=!(Object.keys(b.touchedFields).length>0)||y;return o.jsxs("form",{className:R.form,onSubmit:m(N),children:[o.jsx(nt,{inputName:"file",register:t,control:v,callback:h,accept:"image/*",btnId:d,fileError:e,errorMessage:y}),Object.keys(b.touchedFields).length>0&&o.jsx(L,{className:R.button,type:"submit",color:x?"disabled":"outlined",variant:"smooth",label:"Submit",onClick:l=>l.currentTarget.blur()})]})},ut="_form_1ahl5_1",ft={form:ut},$=Object.keys(U.fields),pt=()=>{const k=A(),_=C(),{id:a}=B(),{user:e}=F(),r=$.filter(s=>s.includes("link"));let t=p.useMemo(()=>r.map((s,n)=>{if(e!=null&&e.user_links&&!e.user_links[n])return s}).filter(s=>s&&s).slice(1),[r,e==null?void 0:e.user_links]);t=p.useMemo(()=>t.length?$.filter(s=>s.includes("_link")):t,[t]);const v=p.useMemo(()=>r.reduce((s,n,c)=>e!=null&&e.user_links&&(e!=null&&e.user_links[c])?{...s,[n]:e==null?void 0:e.user_links[c]}:s,{}),[r,e==null?void 0:e.user_links]),m=W(U),{register:b,handleSubmit:N,watch:h,formState:d}=T({resolver:m,mode:"onChange",defaultValues:{...e,...v}}),{errors:g,isValid:y,touchedFields:E}=d,x=async s=>{const n=Number(a),c=r.map(u=>s[u]).filter(u=>u&&u);await _(X({user_id:n,...s,user_links:c}));const{payload:f}=await _(V({user_id:n}));O.success(f.detail),k(M(!1))};$.map(s=>h(s)),p.useEffect(()=>{const s=$.filter(n=>n.includes("link")).map(n=>{const c=document.querySelector(`input[name="${n}"]`),f=c==null?void 0:c.closest("label");return{input:c,label:f}});if(s&&s[0].input)for(let n=0;n<s.length-1;n+=1)s[n].input.value?s[n+1].label.style.display="block":s[n+1].label.style.display="none"},[v]);const l=!y||Object.keys(E).length===0;return o.jsxs("form",{className:ft.form,onSubmit:N(x),children:[$.map(s=>o.jsx(Q,{style:{display:t.includes(s)?"none":"block"},inputName:s,errors:g,watch:h,register:b},s)),o.jsx(L,{type:"submit",color:l?"disabled":"outlined",variant:"smooth",label:"Submit",onClick:s=>s.currentTarget.blur(),onMouseOver:s=>s.currentTarget.focus()})]})},_t="_screen_1oc64_1",bt="_main_1oc64_9",ht="_avatar_1oc64_17",kt="_name_1oc64_21",vt="_title_1oc64_27",S={screen:_t,main:bt,avatar:ht,name:kt,title:vt},Nt=()=>{var u,P;const k=A(),_=C(),{id:a}=B(),{checkedCompanies:e}=Y(),{owner:r,user:t,profileInfo:v,appendix:m}=F(),{edit:b,loading:N}=F(),{userData:h}=Z();p.useEffect(()=>{_(V({user_id:Number(a)}))},[_,a]);const d=p.useMemo(()=>m==="checked"?[...e].sort((i,j)=>i.company_id-j.company_id):m&&[...h[m]].sort((i,j)=>i.company_id-j.company_id),[m,e,h]);if(!t)return;const g=(r==null?void 0:r.user_id)===a,y=!N&&a===((u=t==null?void 0:t.user_id)==null?void 0:u.toString()),E=b==="avatar"||a===((P=r==null?void 0:r.user_id)==null?void 0:P.toString()),x=b==="data",l={id:t==null?void 0:t.user_id,url:t==null?void 0:t.user_avatar,name:`${t==null?void 0:t.user_firstname} ${t==null?void 0:t.user_lastname}`},s=ot(v),n=t.user_links?t.user_links:[],c=()=>{const i=(t==null?void 0:t.user_firstname)!==(t==null?void 0:t.user_lastname),j=I((t==null?void 0:t.user_firstname)??""),w=I((t==null?void 0:t.user_lastname)??"");return i?`${j} ${w}`:j},f=i=>{if(!(r!=null&&r.is_superuser)&&!g){i.preventDefault(),i.currentTarget.blur(),O.error("It's not your account");return}return k(M("avatar"))};return y?o.jsxs(it,{className:st("container",S.screen),children:[o.jsxs("div",{children:[o.jsxs("div",{className:S.main,children:[E&&o.jsx(dt,{}),!E&&o.jsx(at,{className:S.avatar,ava:l,size:"xl",onClick:f}),o.jsx(D,{className:S.name,children:c()})]}),x&&o.jsx(pt,{}),!x&&o.jsx(rt,{info:s,links:n})]}),o.jsxs("div",{className:S.appendix,children:[m?o.jsx(D,{className:S.title,children:`My ${m}:`}):o.jsx("span",{}),d==null?void 0:d.map(i=>i&&o.jsx(ct,{props:i},i==null?void 0:i.company_id))]})]}):o.jsx(tt,{})};export{Nt as default};
